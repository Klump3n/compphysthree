\documentclass[10pt,a4paper]{article}
%]{report}

\usepackage[a4paper, top=2cm, bottom=2.5cm, left=3cm, right=3cm]{geometry}
%\usepackage[
%    vmarginratio=2:2.5, %Verhï¿½ltnis der oben/unten Seitenrï¿½nder zur automatischen Berechnung
%    paper=a4paper,
%    lmargin=3cm, % mittlerer Rand
%    rmargin=3cm, % ï¿½uï¿½erer Rand
%    marginparwidth=2.3cm, % Breite des Marginpars
%    includehead, % Kopfzeile in Berechnung einbeziehen
%    includemp % Marginpar in die Berechnung mit einbeziehen
%]{geometry}
%\setlength\marginparwidth{2.3cm} %Die wird spï¿½ter zum Rechnen gebraucht, wird aber durch die Angabe im geometry package nicht automatisch richtig gesetzt.


%============================================================
% Pakete
%============================================================

\usepackage[english, ngerman]{babel}    % mehrsprachiger Textsatz
% babel: letzte Sprache in Optionen zeigt die Sprache des Dokumentes
% und kann durch den Befehl \selectlanguage{} geaendert werden
% Passen Sie die Optionen des babel-Paketes nach Bedarf an!
\usepackage[utf8]{inputenc}       % Eingabekodierung Parameter latin1 darf geï¿½ndert werden
\usepackage[T1]{fontenc}                % Schriftenkodierung
\usepackage{graphicx}                       % zum Einbinden von Grafiken
\usepackage{lmodern}                        % Ersatz fuer Computer Modern-Schriften
                                                                % zum besseren Aussehen am Bildschirm
\usepackage{epstopdf}		% Grafiken einbinden
\usepackage{caption}		%Grafiken beschriften
%\usepackage{verbatimfiles}	% Ganze Dateien als Verbatim einbinden
% \usepackage{programs}	% Ganze Dateien als Verbatim einbinden
\usepackage{verbatim}		% Mehrzeilige Kommentare
\usepackage{multicol}		% Mehrere Spalten
\usepackage{hyphsubst}		% Silbentrennung
\usepackage{xcolor,soul}
\usepackage{float}				%Sachen an der richtigen Stelle ausgeben
\restylefloat{figure}				%Abbildungen an der richtigen Stelle ausgeben
\restylefloat{table}				%Tabellen an der richtigen Stelle ausgeben
\usepackage{array}				%fï¿½r Tabellen
\newcolumntype{C}{>{$}c<{$}} 	%Tabellenspalten C mit mathematischem Inhalt
% \usepackage{subfigure}
\usepackage{ulem}				%doppelt unterstreichen
\usepackage{siunitx}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{subcaption}

\usepackage{etex} %needs to be used to avoid 'no room error in pgfplots'
\usepackage{pgfplots}
\usepackage{tikz}
\usepackage{tikz-3dplot}
%\usepackage{tikzscale}
\usepgfplotslibrary{polar}
\usetikzlibrary[pgfplots.colormaps]
\pgfplotsset{compat=newest}
\pgfplotsset{plot coordinates/math parser=false}
\newlength\figureheight
\newlength\figurewidth
%\pgfplotsset{y tick label style={/pgf/number format/fixed}}
%\pgfplotsset{yticklabel style={text width=2.2em,align=right}}%,fixed zerofill, precision=1}}
%\pgfplotsset{every x tick/.append style={line width=1pt}}
%\pgfplotsset{every y tick/.append style={line width=1pt}}
%\pgfplotsset{every axis plot/.append style={line width=1.0pt}}
%\pgfplotscreateplotcyclelist{mycolorlist}{blue,red,green,brown,teal,orange,violet,cyan,green!70!black,magenta,gray}

\usepackage{tikzscale}
\usetikzlibrary{external}
\usetikzlibrary{fadings}
\usetikzlibrary{arrows}
\usetikzlibrary{calc}
\usetikzlibrary{plotmarks}
\usepgfplotslibrary{external}
\tikzset{external/force remake=false}
\tikzset{external/system call={pdflatex \tikzexternalcheckshellescape -halt-on-error -interaction=batchmode -jobname "\image" "\texsource"}}

\tikzexternalize

% define colors for source code list
\definecolor{colKeys}{rgb}{0,0,1}
\definecolor{colIdentifier}{rgb}{0,0,0}
\definecolor{colComments}{rgb}{0,1,0.3}
%\definecolor{colString}{rgb}{0,0.5,0}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{colString}{rgb}{0.63,0.13,0.94}

% Code-Listings print source code
\usepackage{listings}
\lstset{language=Python,		% choose the language of the code
	inputencoding=latin1,
	keywords={break,case,catch,continue,else,elseif,end,for,function,
	 global,if,otherwise,persistent,return,switch,try,while,ones,zeros},
   	float=hbp,
%  	 basicstyle=\ttfamily\small,				% the size of the fonts that are used for the code
   	identifierstyle=\color{colIdentifier},
   	keywordstyle=\color{blue},
   	commentstyle=\color{dkgreen},
  	stringstyle=\color{colString},
   	columns=flexible,
  	tabsize=2,								% sets default tabsize to 2 spaces
   	%frame=none; %single,
  	 numbers=left,						% where to put the line-numbers
  	 showspaces=false,                               % show spaces adding particular underscores
  	 numberstyle=\ttfamily\small\color{gray},
% numberstyle=\footnotesize,                      % the size of the fonts that are used for the line-numbers
  	 stepnumber=1,                                           % the step between two line-numbers. If it's 1 each line will be numbered
  	 numbersep=10pt,                                  % how far the line-numbers are from the code
  	 showspaces=false,
  	 showstringspaces=false,                         % underline spaces within strings
  	 breakautoindent=true,                        % sets if automatic breaks should only happen at whitespace
%       backgroundcolor=\color{white},          % choose the background color. You must add \usepackage{color}
%  	     showtabs=false,                                         % show tabs within strings adding particular underscores
%       frame=single,                                           % adds a frame around the code
%       captionpos=b,                                           % sets the caption-position to bottom
%        escapeinside={\%*}{*)                          % if you want to add a comment within your code
        breaklines=true}                                       % sets automatic line breaking

% Mathe-Pakete
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amsthm}		% Theorem-Umgebung, Beweise
\usepackage{amssymb}
\usepackage{cancel}
\usepackage{mathcomp}
\usepackage{nicefrac}

\usepackage{libertine}
\usepackage[libertine]{newtxmath}

%============================================================
% Titel, Autor, Datum
%============================================================
\title{Übung 5 \\Computational Physics III}
\author{Matthias Plock (552335) \and Paul Ledwon (561764)} %\\Otto Normalverbraucher (271828)}
\date{\today}

%============================================================
% Dokument
%============================================================
\begin{document}

% Titel erstellen
\maketitle
\tableofcontents

\pagenumbering{arabic}
\pagestyle{myheadings}                  % bzw. ist fancyhdr zu benutzten

\section{Spin-Modell}

\subsection{Über das Programm}

Der Programmcode liegt im Verzeichnis \texttt{src}, dort wurden zwei Dateien
erstellt. In der Datei \texttt{boltzmann.\{cu,h\}} sind die Programmfunktionen
implementiert, in der Datei \texttt{cases.\{cu,h\}} sind die
Testfälle/Aufgabenstellungen implementiert.

Das Programm wird mit Hilfe des Makefiles kompiliert und kann dann durch Aufruf
der Datei im Verzeichnis \texttt{bin} aufgerufen werden.
Die Aufgaben 1 bis 3 werden dann ausgeführt. Jedes Ergebnis wird durch ein
\texttt{assert()} getestet. Als Genauigkeitsgrenze wird konservativ
$N_{\text{Vol}}*\varepsilon$ gesetzt.

\subsection{Aufgabe 1}

Wir wählen als Dimension $N_{\text{Dim}} = 3$ und setzen für jede Dimension $5$
Gitterpunkte, erhalten also $N_{\text{Vol}} = 125$. Dies wird gemacht um die
Routinen zügig zu prüfen.

In einer Schleife über fünf Elemente setzen wir jeweils $z$, $h$, $\lambda$ und
$\kappa$ auf zufällige Werte. Anschließend wird die Wirkung $S\left[ \phi, h
\right]$ berechnet und mit dem analytischen Wert $S_{\text{Analytisch}}$
verglichen.

Die analytische Funktion lässt sich wie folgt darstellen:
\begin{align*}
  S(z, h, \lambda, \kappa)
  &=
    \sum_{x} \left[ |z|^{2} + \lambda \left( |z|^{2} - 1 \right)^{2} -
    \kappa \sum_{1}^{d} \left( z^{*}z + z z^{*}\right) -
    \left( h^{*}z + h z^{*} \right) \right]\\
  &=
    \sum_{x} \left[ |z|^{2} + \lambda \left( |z|^{2} - 1 \right)^{2} -
    2 \kappa d |z|^{2} -
    \left( h^{*}z + h z^{*} \right) \right]\\
  &=
    N_{\text{Vol}} \left[ |z|^{2} + \lambda \left( |z|^{2} - 1 \right)^{2} -
    2 \kappa d |z|^{2} -
    \left( h^{*}z + h z^{*} \right) \right]\,.
\end{align*}

Übereinstimmung der analyischen und der Monte-Carlo Funktion ist ausgezeichnet:
\begin{verbatim}
wirkung monte carlo 0.318527
wirkung analytisch 0.318527
assert:
abs((S_MC - S_ANA) / S_ANA) = 3.485493e-16

wirkung monte carlo 0.213218
wirkung analytisch 0.213218
assert:
abs((S_MC - S_ANA) / S_ANA) = 5.206982e-16

wirkung monte carlo 0.242190
wirkung analytisch 0.242190
assert:
abs((S_MC - S_ANA) / S_ANA) = 3.323475e-15

wirkung monte carlo 0.175598
wirkung analytisch 0.175598
assert:
abs((S_MC - S_ANA) / S_ANA) = 1.580635e-15

wirkung monte carlo 0.198665
wirkung analytisch 0.198665
assert:
abs((S_MC - S_ANA) / S_ANA) = 1.955945e-15
\end{verbatim}
Die relative Abweichung liegt jeweils in einer Größenordnung von \num{1e-15} bis \num{1e-16}.

\subsection{Aufgabe 2}

Wir modifizieren einen zufälligen $\phi$-Vektor mit einer zufälligen Phase
$\alpha$,
\begin{align*}
  \phi' = \left( \cos\left( \alpha \right) + \mathrm{i}\sin\left( \alpha \right) \right) \phi\,.
\end{align*}
Wir berechnen die Wirkung mit $\phi$ und $\phi'$. Die Abweichung hier ist
nicht von \num{0} verschieden.
\begin{verbatim}
originale wirkung 0.286771
modifizierte wirkung 0.286771

assert:
abs((S_mc_orig - S_mc_mod) / S_mc_orig) = 0.000000e+00
\end{verbatim}
Eine komplexe Phase hat also keinen Einfluss auf die Wirkung.

\subsection{Aufgabe 3}

Es wird die Richtigkeit der Gleichung
\begin{align*}
  \frac{P\left[ \phi' \right]}{P\left[ \phi \right]} = \frac{p\left( \phi'_{x} \right)}{p\left( \phi_{x} \right)}
\end{align*}
überprüft, wobei
\begin{align*}
  P\left[ \phi \right] = \exp\left( - S\left[ \phi, h \right] \right)\,.
\end{align*}
Da Ergebnisse von E-Funktionen mitunter sehr groß werden können und es dann
schwierig ist, diese numerisch ordentlich zu behandeln, berechnen wir zunächst
die Argumente der E-Funktionen und bilden den Quotienten durch Subtraktion der
Argumente in einer E-Funktion. Diese Methode ist als \emph{alternativ}
gekennzeichnet. Als Vergleich berechnen wir den Quotienten auch direkt. Auch
hier ist die Übereinstimmung hervorragend.
\begin{verbatim}
p(1) 0.371438
p(2) 0.368600
P(1) 0.000000
P(2) 0.000000
S(1) 124.313789
S(2) 124.321459
p(1)/p(2) 1.007700
P(1)/P(2) 1.007700
p(1)/p(2) alternativ 1.007700
P(1)/P(2) alternativ 1.007700

assert:
abs((div_p1_by_p2 - P_div_S1_by_S2) / div_p1_by_p2) = 2.644175e-15
\end{verbatim}


\section{Markov-Kette}

\subsection{Wahrscheinlichkeitsverteilung}
Jede Konfiguration der Markov-Kette $\Phi^{(1)}\to \Phi^{(2)}\to\dots\to \Phi^{(N)}$
folgt der angestrebten Wahrscheinlichkeitsverteilung, unter der Vorraussetzung,
dass $P[\Phi^{(1)}]$ der Wahrscheinlichkeitsverteilung folgt, denn
 \begin{align*}
	\int \prod_{k\neq n} D\Phi^{(k)} {\cal P}[\Phi^{(1)},...,\Phi^{(N)}] = \int \prod_{k\neq n} D\Phi^{(k)}P[\Phi^{(1)}] W[\Phi^{(1)}\to \Phi^{(2)}]...W[\Phi^{(N-1)}\to \Phi^{(N)}]= \\
	=\int \prod_{k <  n} D\Phi^{(k)}P[\Phi^{(1)}] W[\Phi^{(1)}\to \Phi^{(2)}]...W[\Phi^{(n-1)}\to \Phi^{(n)}] \int \prod_{k > n} D\Phi^{(k)} W[\Phi^{(n)}\to \Phi^{(n+1)}]...W[\Phi^{(N-1)}\to \Phi^{(N)}].
 \end{align*}

Wegen der Normierung gilt

 \begin{align*}
	\int \prod_{k > n} D\Phi^{(k)} W[\Phi^{(n)}\to \Phi^{(n+1)}]...W[\Phi^{(N-1)}\to \Phi^{(N)}]=1.
 \end{align*}

Zusammen mit dem Gleichgewicht $\int D\Phi P[\Phi] W[\Phi\to \Phi'] = P[\Phi']$ gilt dann
 \begin{align*}
      \int \prod_{k\neq n} D\Phi^{(k)} {\cal P}[\Phi^{(1)},...,\Phi^{(N)}] &= \int \prod_{k <  n} D\Phi^{(k)}P[\Phi^{(1)}] W[\Phi^{(1)}\to \Phi^{(2)}]...W[\Phi^{(n-1)}\to \Phi^{(n)}] \\
&=\int \prod_{1 < k <  n} D\Phi^{(k)}P[\Phi^{(2)}] W[\Phi^{(2)}\to \Phi^{(3)}]...W[\Phi^{(n-1)}\to \Phi^{(n)}]\\
&= ...\\
&=\int \prod_{n-2 < k <  n} D\Phi^{(k)}P[\Phi^{(n-1)}] W[\Phi^{(n-1)}\to \Phi^{(n)}] \\
&=\int  D\Phi^{(n-1)}P[\Phi^{(n-1)}] W[\Phi^{(n-1)}\to \Phi^{(n)}] = P[\Phi^{(n)}]
 \end{align*}

\subsection{Detailliertes Gleichgewicht der Metropolis-Übergangswahrscheinlichkeit}
Die Metropolis-Übergangswahrscheinlichkeit ist definiert als

\begin{align*}
	w_m(\Phi_x\to\Phi'_x) = w_v(\Phi_x\to\Phi'_x) \min \left(1,\frac{p(\Phi'_x)}{p(\Phi_x)}\right) + [1-A(\Phi_x)]\delta(\Phi_x,\Phi'_x)
\end{align*}

Die Vorschlagswahrscheinlichkeit soll symmetrisch sein, daher $w_v(\Phi_x\to\Phi_x')=w_v(\Phi_x'\to\Phi_x)$.

Damit das detaillierte Gleichgewicht erfüllt ist, muss gelten

\begin{align}\label{eq:gg}
p(\Phi_x) w_m(\Phi_x\to\Phi'_x)= p(\Phi'_x)w_m(\Phi'_x\to\Phi_x).
\end{align}

Für den Fall $\Phi_x = \Phi'_x$ wird Gleichung \ref{eq:gg} zu

\begin{align*}
	p(\Phi_x) w_v(\Phi_x\to\Phi_x) + [1-A(\Phi_x)] = p(\Phi_x) w_v(\Phi_x\to\Phi_x) + [1-A(\Phi_x)]
\end{align*}

und das detaillierte Gleichgewicht ist erfüllt.

Für den Fall $\Phi_x \neq \Phi_x'$ und ohne Beschränkung der Allgemeinheit $p(\Phi'_x)>p(\Phi_x)$ wird Gleichung \ref{eq:gg} zu

\begin{align*}
		p(\Phi_x) w_v(\Phi_x\to\Phi'_x) \frac{p(\Phi'_x)}{p(\Phi_x)} = p(\Phi_x') w_v(\Phi_x'\to\Phi_x)
		\Leftrightarrow w_v(\Phi_x\to\Phi_x')=w_v(\Phi_x'\to\Phi_x)
\end{align*}

Auch in diesem Fall ist wegen der Symmetrie der Vorschlagswahrscheinlichkeit das detaillierte Gleichgewicht erfüllt.

\subsection{Gleichgewicht}

Wenn $W_1$ und $W_2$ im Gleichgewicht mit $P$ sind, dann ist auch\\
 $W[\Phi\to \Phi']=\int D\Phi'' W_1[\Phi\to \Phi''] W_2[\Phi''\to\Phi']$
im Gleichgewicht mit $P$, denn
\begin{align*}
\int D\Phi'P[\Phi] W[\Phi\to \Phi'] = \int D\Phi D\Phi'' P[\Phi] W_1[\Phi\to \Phi''] W_2[\Phi''\to\Phi'] = \int D\Phi'' P[\Phi''] W_2[\Phi''\to\Phi'] = P[\Phi'].
\end{align*}



\end{document}
